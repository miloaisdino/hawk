Getting Started
------

This guide covers the basic authentication by a server and making request by a client, for more advanced usage see the
respective docs.

### Installation

The library can be installed using composer, currently it's not listed on packagist. An example composer.json:

```json
{
  "repositories": [
    {
      "type": "vcs",
      "url": "https://github.com/Dragooon/php-hawk"
    }
  ],
  "require": {
    "Dragooon/hawk": "dev-master"
  }
}
```

Including the above in composer.json and including vendor/autoload.php into your PHP scripts should allow you to
start using the library. See composer documentation for more information

### Server

For a server to be able to authenticate Hawk requests, you need to use Dragooon\Hawk\Server\Server library. The
constructor requires 6 arguments

- **Crypto**: The cryptographic library, Dragooon\Hawk\Crypto\Crypto should be enough
- **CredentialsProvider**: A Credentials provider to be able to load any authenticating user by ID, see docs/Credentials.md
for more information
- **TimeProvider**: An object to provide current time information, default implementation in Dragooon\Hawk\Time\TimeProvider
simply returns the current UNIX timestamp
- **NonceValidator**: A validator for Nonce values. See official Hawk documentation for more infromation on Nonce values
- **TimestampSkewSec**: Difference (in seconds) to allow for two different timestamps to be considered equal. Defaults
to 60
- **LocaltimeOffsetSec**: Offset by which current timestamp is shifted before validating

The above arguments can be simplified using ServerBuilder which loads the default objects and values and simply requires
the Credentials Provider

Example:

```php
$credentialsProvider = new Dragooon\Hawk\Credentials\CallbackCredentialsProvider(
    function($id) {
        if ('12345' === $id) {
            return new Dragooon\Hawk\Credentials\Credentials(
                'afe89a3x',  // shared key
                'sha256',    // default: sha256
                '12345'      // identifier, default: null
            );
        }
    }
);

$server = Dragooon\Hawk\Server\ServerBuilder::create($credentialsProvider)
    ->build()
```

###### Checking whether a request is using Hawk protocol or not

Any Hawk request is authenticated by checking the Authorization HTTP header. It should start from Hawk to check for
validity.

Example request from a client:

```
   GET /resource/1?b=1&a=2 HTTP/1.1
   Host: example.com:8000
   Authorization: Hawk id="dh37fgj492je", ts="1353832234", nonce="j4h3g2", ext="some-app-ext-data", mac="6R4rV5iE+NPoym+WwjeHzjAGXUtLNIxmo1vpMofpLAE="
```

Example to see if a request is a Hawk request:

```php
$authorization = $_SERVER['HTTP_AUTHORIZATION']; // HTTP's Authorization passed by the client

if ($server->checkRequestForHawk($authorization) {
    // This is a hawk request
}
else {
    // This is something else
}
```

###### Authenticating a client

Now that we're aware whether it's a Hawk request or not, we'd need to authenticate a client.

```php
try {
    $response = $server->authenticate(
                        'POST',
                        'example.com',
                        80,
                        '/foo/bar?whatever',
                        'text/plain',
                        'hello world!'
                        $authorization
                    );
    // The client authenticated if no exceptions were thrown
}
} catch(Dragooon\Hawk\Server\UnauthorizedException $e) {
    // The client failed to authenticate
}

$credentials = $response->credentials(); // This can be used to see which client's ID is it to identify the user
```

Remember that the id parameter is always passed in the Authorization header, this same ID is passed to
CredentialsProvider in order to identify which client the server needs to authenticate.

### Client

A client is any node making request to a server using Hawk protocol. An example request generated by a client is given
above. Dragooon\Hawk\Client\Client requires 4 arguments by default

- **Crypto**: The cryptographic library, Dragooon\Hawk\Crypto\Crypto should be enough
for more information
- **TimeProvider**: An object to provide current time information, default implementation in Dragooon\Hawk\Time\TimeProvider
simply returns the current UNIX timestamp
- **NonceValidator**: A validator for Nonce values. See official Hawk documentation for more infromation on Nonce values
- **LocaltimeOffsetSec**: Offset by which current timestamp is shifted before validating

The above arguments can be simplified by using Dragooon\Hawk\Client\ClientBuilder which doesn't require any arguments
by default

```php
$client = Dragooon\Hawk\Client\ClientBuilder::create()
    ->build();
```

###### Creating a request

A client can create a request simply by

```php
$request = $client->createRequest(
    $credentials, // Instance of Dragooon\Hawk\Credentials\CredentialsInterface
    'http://example.com/foo/bar?whatever',
    'GET',
    array(
    )
);

// Once the request has been created, 
$headerField = $request->header()->fieldName(); // Field name, for example "Authorization"
$headerValue = $request->header()->fieldValue(); // Value for the above field
```

The above header field value can be passed to the server in the request using your favourite HTTP library, cURL for
example:

```php
$headers = array();
$headers[] = $request->header()->fieldName() . ': ' . $request->header()->fieldValue();

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, "http://example.com");
curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);

$response = curl_exec($ch);

curl_close($ch);
```